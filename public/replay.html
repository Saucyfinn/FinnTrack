<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinnTrack - Replay</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        .page-container {
            display: flex;
            height: calc(100vh - 61px);
        }
        #sidebar {
            top: 61px;
            height: calc(100vh - 61px);
        }
        #map {
            top: 61px;
            height: calc(100vh - 121px);
        }
        .toggle-group {
            margin: 15px 0;
        }
        .toggle-group h3 {
            margin-bottom: 8px;
            font-size: 13px;
            color: #666;
        }
        .toggle-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }
        .toggle-item input {
            accent-color: var(--accent);
        }
        .toggle-item label {
            font-size: 13px;
            cursor: pointer;
        }
        .export-group {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        .export-group h3 {
            margin-bottom: 8px;
            font-size: 13px;
            color: #666;
        }
        #boatList {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 250px;
            overflow-y: auto;
        }
        .replay-controls {
            position: fixed;
            bottom: 0;
            left: 260px;
            right: 0;
            background: white;
            border-top: 1px solid var(--border);
            padding: 12px 20px;
            z-index: 1000;
        }
        .controls-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        #timeline {
            flex: 1;
        }
        #frameInfo {
            font-family: monospace;
            font-size: 13px;
            min-width: 100px;
            text-align: center;
        }
        .playback-buttons {
            display: flex;
            gap: 5px;
        }
        .events-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #eventTrack {
            position: relative;
            flex: 1;
            height: 14px;
            background: #eee;
            border-radius: 7px;
        }
        #eventButtons {
            display: flex;
            gap: 5px;
        }
        #eventButtons button {
            padding: 4px 10px;
            font-size: 12px;
        }
    </style>
</head>

<body>

<header>
    <img src="/assets/logo.svg" id="logo">
    <nav>
        <a href="/">Home</a>
        <a href="/live.html">Live</a>
        <a href="/replay.html" style="color: var(--primary);">Replay</a>
        <a href="/analytics.html">Analytics</a>
    </nav>
</header>

<div id="sidebar">
    <h2>Race Replay</h2>

    <div style="margin: 15px 0;">
        <label for="raceSelect" style="font-size: 13px; color: #666;">Race:</label>
        <select id="raceSelect" style="width: 100%; padding: 8px; margin-top: 5px;"></select>
        <button id="loadRaceBtn" style="width: 100%; margin-top: 8px;">Load Race</button>
    </div>

    <h3>Boats</h3>
    <ul id="boatList"></ul>

    <div class="toggle-group">
        <h3>Display</h3>
        <div class="toggle-item">
            <input type="checkbox" id="toggleLabels" checked>
            <label for="toggleLabels">Labels</label>
        </div>
        <div class="toggle-item">
            <input type="checkbox" id="toggleVectors" checked>
            <label for="toggleVectors">Vectors</label>
        </div>
        <div class="toggle-item">
            <input type="checkbox" id="toggleTrails" checked>
            <label for="toggleTrails">Trails</label>
        </div>
    </div>

    <div class="toggle-group">
        <h3>Course</h3>
        <div class="toggle-item">
            <input type="checkbox" id="toggleStart" checked>
            <label for="toggleStart">Start Line</label>
        </div>
        <div class="toggle-item">
            <input type="checkbox" id="toggleFinish" checked>
            <label for="toggleFinish">Finish Line</label>
        </div>
        <div class="toggle-item">
            <input type="checkbox" id="toggleMarks" checked>
            <label for="toggleMarks">Marks</label>
        </div>
        <div class="toggle-item">
            <input type="checkbox" id="togglePolygon" checked>
            <label for="togglePolygon">Course Area</label>
        </div>
    </div>

    <div class="export-group">
        <h3>Export</h3>
        <button id="exportGPX">GPX</button>
        <button id="exportKML">KML</button>
        <button id="exportJSON">JSON</button>
    </div>
</div>

<div id="map"></div>

<div class="replay-controls">
    <div class="controls-row">
        <div class="playback-buttons">
            <button id="playBtn">▶ Play</button>
            <button id="pauseBtn">⏸ Pause</button>
            <button id="stepBtn">⏭ Step</button>
        </div>
        <input type="range" id="timeline" min="0" max="100" value="0">
        <span id="frameInfo">0 / 0</span>
        <select id="speedSelect">
            <option value="0.25">0.25x</option>
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="2">2x</option>
            <option value="4">4x</option>
        </select>
    </div>
    <div class="events-row">
        <span style="font-size: 12px; color: #666;">Events:</span>
        <div id="eventTrack"></div>
        <div id="eventButtons"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="/js/api.js"></script>
<script src="/js/map.js"></script>
<script src="/js/replay.js"></script>

</body>
</html>
